<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>DIGIY LOC PRO ‚Äî M√©dias</title>

  <style>
    :root{
      /* ‚òÄÔ∏è SABLE + VERT S√âN√âGAL (clair ext√©rieur) */
      --bg:#fefce8;          /* sable clair */
      --bg2:#fef3c7;         /* sable dor√© */
      --card:#dcfce7;        /* vert clair */
      --card2:#bbf7d0;       /* vert doux */
      --accent:#facc15;      /* or DIGIY */
      --text:#064e3b;        /* vert fonc√© lisible */
      --muted:#166534;       /* secondaire */
      --ink:#022c22;         /* sombre pour boutons */
      --danger:#ef4444;
      --shadow:0 10px 25px rgba(0,0,0,.12);
      --border:rgba(22,163,74,.25);
      --cyanbg:#ecfeff;
      --cyanbd:rgba(6,182,212,.25);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(900px 500px at 20% 0%, rgba(250,204,21,.28), transparent 60%),
        radial-gradient(800px 500px at 80% 20%, rgba(34,197,94,.22), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      color:var(--text);
      min-height:100vh;
    }

    header{
      position:sticky; top:0; z-index:10;
      background:rgba(254,252,232,.92);
      backdrop-filter: blur(8px);
      border-bottom:1px solid var(--border);
    }
    .bar{
      max-width:780px; margin:auto;
      padding:12px 16px;
      display:flex; align-items:center; gap:12px;
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:950}
    .logo{
      width:38px;height:38px;border-radius:14px;
      display:grid;place-items:center;
      background:var(--accent);
      color:var(--ink);
      box-shadow:var(--shadow);
      font-weight:1000;
    }
    .brand small{display:block; color:var(--muted); font-weight:800}
    .pill{
      margin-left:auto;
      padding:8px 14px;
      border-radius:999px;
      background:linear-gradient(135deg,#22c55e,#86efac);
      color:var(--ink);
      font-weight:950;
      font-size:.86rem;
      box-shadow:var(--shadow);
      border:1px solid rgba(2,44,34,.08);
    }

    main{max-width:780px;margin:auto;padding:18px 16px 34px}

    .hero{
      background:linear-gradient(135deg,var(--card),var(--card2));
      border:1px solid var(--border);
      border-radius:22px;
      padding:18px;
      box-shadow:var(--shadow);
    }
    .hero h1{font-size:1.25rem;margin-bottom:6px}
    .hero p{color:#065f46;line-height:1.4;font-weight:650}
    .note{
      margin-top:10px;
      padding:10px 12px;
      border-radius:16px;
      background:var(--cyanbg);
      border:1px solid rgba(6,182,212,.35);
      color:#0f766e;
      font-size:.86rem;
      font-weight:800;
    }

    .grid{display:grid;gap:14px;margin-top:14px}

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:22px;
      padding:16px;
      box-shadow:var(--shadow);
    }
    .card h2{font-size:1.06rem;margin-bottom:8px}
    .hint{color:#065f46;font-size:.92rem;line-height:1.35;margin-bottom:12px;font-weight:650}

    .row{display:flex; gap:10px; flex-wrap:wrap}
    .btn{
      flex:1; min-width:170px;
      padding:12px 14px;
      border-radius:16px;
      border:none;
      cursor:pointer;
      font-weight:1000;
      box-shadow:var(--shadow);
      font-size:.95rem;
    }
    .btn.primary{background:var(--accent); color:var(--ink)}
    .btn.secondary{background:#22c55e; color:var(--ink)}
    .btn.ghost{
      background:var(--cyanbg);
      border:1px solid rgba(6,182,212,.35);
      color:#065f46;
    }
    .btn.danger{
      background:rgba(239,68,68,.15);
      border:1px solid rgba(239,68,68,.45);
      color:#7f1d1d;
    }
    .btn:hover{filter:brightness(1.03)}

    /* Galerie */
    #photoInput{display:none}
    .gallery{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:12px;
      margin-top:12px;
    }
    .tile{
      position:relative;
      border-radius:20px;
      overflow:hidden;
      aspect-ratio:1/1;
      background:var(--cyanbg);
      border:1px solid var(--cyanbd);
      box-shadow:var(--shadow);
    }
    .tile img{width:100%;height:100%;object-fit:cover;display:block}
    .tile .empty{
      width:100%;height:100%;
      display:grid;place-items:center;
      font-size:1.9rem;font-weight:1000;
      color:#0f766e;
    }
    .badge{
      position:absolute; left:10px; top:10px;
      background:rgba(2,44,34,.85);
      color:#fff;
      padding:6px 10px;
      border-radius:999px;
      font-size:.72rem;
      font-weight:950;
      border:1px solid rgba(250,204,21,.6);
      backdrop-filter: blur(6px);
    }
    .top-actions{
      position:absolute; right:10px; top:10px;
      display:flex; gap:8px;
    }
    .iconbtn{
      width:38px;height:38px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(2,44,34,.65);
      color:#fff;
      font-weight:1000;
      cursor:pointer;
    }
    .tile-footer{
      position:absolute; left:0; right:0; bottom:0;
      padding:10px;
      display:flex; gap:8px; justify-content:space-between; flex-wrap:wrap;
      background:linear-gradient(180deg, transparent, rgba(2,44,34,.78));
    }
    .smallbtn{
      border:none; cursor:pointer;
      padding:8px 10px;
      border-radius:14px;
      font-weight:1000;
      font-size:.75rem;
    }
    .smallbtn.main{background:rgba(250,204,21,.98); color:var(--ink)}
    .smallbtn.sec{
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.18);
      color:#fff;
    }

    /* Localisation */
    .field label{display:block;font-weight:1000;margin-bottom:6px}
    .field input{
      width:100%;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid var(--border);
      background:#ffffff;
      color:#064e3b;
      outline:none;
      font-weight:800;
      box-shadow:var(--shadow);
    }
    .map-preview{
      margin-top:10px;
      min-height:120px;
      border-radius:18px;
      background:var(--cyanbg);
      border:1px solid var(--cyanbd);
      display:flex; align-items:center; justify-content:center;
      text-align:center;
      padding:12px;
      color:#065f46;
      line-height:1.35;
      font-weight:650;
    }

    @media(min-width:600px){
      .gallery{grid-template-columns:repeat(4,1fr)}
    }
  </style>
</head>

<body>

<header>
  <div class="bar">
    <div class="brand">
      <div class="logo">‚àû</div>
      <div>
        DIGIY LOC PRO
        <small>M√©dias & Localisation</small>
      </div>
    </div>
    <div class="pill">‚òÄÔ∏è Sable ¬∑ Vert S√©n√©gal</div>
  </div>
</header>

<main>

  <section class="hero">
    <h1>Interface PRO ‚Äî claire & terrain</h1>
    <p>Ajoute tes photos, fixe ton adresse, et le client arrive direct (GPS).</p>
    <div class="note">‚úîÔ∏è Sans Supabase ¬∑ ‚úîÔ∏è Boutons OK ¬∑ ‚úîÔ∏è Sauvegarde locale (navigateur)</div>
  </section>

  <div class="grid">

    <!-- MEDIAS -->
    <section class="card" id="medias">
      <h2>üì∏ Galerie photos</h2>
      <p class="hint">Fa√ßade, int√©rieur, chambres, vue, √©quipements. La photo principale = la cover.</p>

      <input id="photoInput" type="file" accept="image/*" multiple />

      <div class="row">
        <button class="btn primary" id="btnAdd">‚ûï Ajouter des photos</button>
        <button class="btn ghost" id="btnExport">‚¨áÔ∏è T√©l√©charger la cover</button>
        <button class="btn danger" id="btnClear">üßπ Tout effacer</button>
      </div>

      <div class="gallery" id="gallery"></div>
    </section>

    <!-- LOCALISATION -->
    <section class="card" id="localisation">
      <h2>üìç Localisation Google Maps</h2>
      <p class="hint">Adresse + nom du lieu. Le bouton ouvre Google Maps directement.</p>

      <div class="field">
        <label for="addr">Adresse / Nom (ex: ‚ÄúChez Baptiste, Saly Centre‚Äù)</label>
        <input id="addr" type="text" placeholder="Nom + quartier + ville" />
      </div>

      <div class="row" style="margin-top:10px">
        <button class="btn secondary" id="btnMaps">üìç Ouvrir Google Maps</button>
        <button class="btn ghost" id="btnSaveLoc">üíæ Sauver</button>
      </div>

      <div class="map-preview" id="mapPreview">
        Mets une adresse ci-dessus puis clique ‚ÄúOuvrir Google Maps‚Äù.
      </div>
    </section>

  </div>

</main>

<script>
  // =========================
  //  UI-only : LocalStorage
  // =========================
  const LS_KEY = "digiy_loc_pro_medias_sable_v1";
  const LS_LOC = "digiy_loc_pro_location_sable_v1";

  const galleryEl = document.getElementById("gallery");
  const photoInput = document.getElementById("photoInput");
  const btnAdd = document.getElementById("btnAdd");
  const btnClear = document.getElementById("btnClear");
  const btnExport = document.getElementById("btnExport");

  const addrEl = document.getElementById("addr");
  const btnMaps = document.getElementById("btnMaps");
  const btnSaveLoc = document.getElementById("btnSaveLoc");
  const mapPreview = document.getElementById("mapPreview");

  function loadState(){
    try { return JSON.parse(localStorage.getItem(LS_KEY)) || { photos: [], coverIndex: 0 }; }
    catch { return { photos: [], coverIndex: 0 }; }
  }
  function saveState(s){ localStorage.setItem(LS_KEY, JSON.stringify(s)); }
  function loadLoc(){ return localStorage.getItem(LS_LOC) || ""; }
  function saveLoc(v){ localStorage.setItem(LS_LOC, v || ""); }

  let state = loadState();

  // -------------------------
  // Galerie
  // -------------------------
  function render(){
    galleryEl.innerHTML = "";

    if(!state.photos.length){
      for(let i=0;i<6;i++){
        const t = document.createElement("div");
        t.className = "tile";
        t.innerHTML = `<div class="empty">+</div>`;
        t.title = "Ajouter des photos";
        t.addEventListener("click", ()=> photoInput.click());
        galleryEl.appendChild(t);
      }
      return;
    }

    state.photos.forEach((src, idx) => {
      const isCover = idx === (state.coverIndex ?? 0);

      const tile = document.createElement("div");
      tile.className = "tile";
      tile.innerHTML = `
        ${isCover ? `<div class="badge">Photo principale</div>` : ``}
        <div class="top-actions">
          <button class="iconbtn" data-del="${idx}" title="Supprimer">‚úï</button>
        </div>
        <img src="${src}" alt="Photo ${idx+1}">
        <div class="tile-footer">
          <button class="smallbtn main" data-cover="${idx}">‚òÖ Principal</button>
          <button class="smallbtn sec" data-left="${idx}">‚Üê</button>
          <button class="smallbtn sec" data-right="${idx}">‚Üí</button>
        </div>
      `;
      galleryEl.appendChild(tile);
    });

    // actions
    galleryEl.querySelectorAll("[data-del]").forEach(b=>{
      b.addEventListener("click",(e)=>{
        e.stopPropagation();
        const i = Number(b.getAttribute("data-del"));
        state.photos.splice(i,1);
        if(state.coverIndex >= state.photos.length) state.coverIndex = 0;
        saveState(state); render();
      });
    });

    galleryEl.querySelectorAll("[data-cover]").forEach(b=>{
      b.addEventListener("click",(e)=>{
        e.stopPropagation();
        state.coverIndex = Number(b.getAttribute("data-cover"));
        saveState(state); render();
      });
    });

    galleryEl.querySelectorAll("[data-left]").forEach(b=>{
      b.addEventListener("click",(e)=>{
        e.stopPropagation();
        const i = Number(b.getAttribute("data-left"));
        if(i<=0) return;
        const tmp = state.photos[i-1];
        state.photos[i-1] = state.photos[i];
        state.photos[i] = tmp;

        if(state.coverIndex === i) state.coverIndex = i-1;
        else if(state.coverIndex === i-1) state.coverIndex = i;

        saveState(state); render();
      });
    });

    galleryEl.querySelectorAll("[data-right]").forEach(b=>{
      b.addEventListener("click",(e)=>{
        e.stopPropagation();
        const i = Number(b.getAttribute("data-right"));
        if(i >= state.photos.length-1) return;
        const tmp = state.photos[i+1];
        state.photos[i+1] = state.photos[i];
        state.photos[i] = tmp;

        if(state.coverIndex === i) state.coverIndex = i+1;
        else if(state.coverIndex === i+1) state.coverIndex = i;

        saveState(state); render();
      });
    });
  }

  btnAdd.addEventListener("click", ()=> photoInput.click());

  photoInput.addEventListener("change", async () => {
    const files = Array.from(photoInput.files || []);
    if(!files.length) return;

    for(const f of files){
      const dataUrl = await fileToDataURL(f);
      state.photos.push(dataUrl);
    }
    if(state.coverIndex == null) state.coverIndex = 0;
    saveState(state);
    render();
    photoInput.value = "";
  });

  btnClear.addEventListener("click", ()=>{
    if(!confirm("Tout effacer (local navigateur) ?")) return;
    state = { photos: [], coverIndex: 0 };
    saveState(state);
    render();
  });

  btnExport.addEventListener("click", ()=>{
    if(!state.photos.length){
      alert("Ajoute au moins une photo d‚Äôabord.");
      return;
    }
    const cover = state.photos[state.coverIndex ?? 0];
    downloadDataUrl(cover, "digiy-cover.jpg");
  });

  function fileToDataURL(file){
    return new Promise((resolve,reject)=>{
      const reader = new FileReader();
      reader.onload = ()=> resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  function downloadDataUrl(dataUrl, filename){
    const a = document.createElement("a");
    a.href = dataUrl;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
  }

  // -------------------------
  // Google Maps (sans API)
  // -------------------------
  function mapsUrlFromAddress(addr){
    const q = encodeURIComponent(addr.trim());
    return `https://www.google.com/maps/search/?api=1&query=${q}`;
  }

  function escapeHtml(str){
    return str.replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));
  }

  function refreshPreview(){
    const addr = addrEl.value.trim();
    if(!addr){
      mapPreview.textContent = "Mets une adresse ci-dessus puis clique ‚ÄúOuvrir Google Maps‚Äù.";
      return;
    }
    mapPreview.innerHTML = `
      <div>
        <div style="font-weight:1000;margin-bottom:6px">Aper√ßu</div>
        <div style="opacity:.9">${escapeHtml(addr)}</div>
        <div style="margin-top:8px;font-size:.9rem;opacity:.8">Le bouton ouvre Google Maps avec guidage.</div>
      </div>
    `;
  }

  btnMaps.addEventListener("click", ()=>{
    const addr = addrEl.value.trim();
    if(!addr){ alert("Mets une adresse d‚Äôabord."); return; }
    window.open(mapsUrlFromAddress(addr), "_blank");
  });

  btnSaveLoc.addEventListener("click", ()=>{
    saveLoc(addrEl.value.trim());
    alert("Adresse sauvegard√©e (local).");
  });

  addrEl.addEventListener("input", refreshPreview);

  // Init
  addrEl.value = loadLoc();
  refreshPreview();
  render();
</script>

</body>
</html>
